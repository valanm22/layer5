{
    "componentChunkName": "component---src-templates-resource-single-js",
    "path": "/resources/service-mesh/istio-ingress-gateway-in-kubernetes",
    "result": {"data":{"mdx":{"body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Istio Ingress Gateway in Kubernetes\",\n  \"thumbnail\": \"./Istio Ingress Gateway.png\",\n  \"category\": \"Service Mesh\",\n  \"tags\": [\"Gateway\"],\n  \"type\": \"Article\",\n  \"product\": \"Meshery\",\n  \"technology\": \"Kubernetes\",\n  \"mesh\": \"Istio\",\n  \"featured\": false,\n  \"published\": true,\n  \"resource\": true\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(ResourcesWrapper, {\n    mdxType: \"ResourcesWrapper\"\n  }, mdx(\"p\", null, \"Predominantly, Kubernetes has used an Ingress controller to handle the traffic that enters the cluster from the outside. Istio has replaced all the familiar Ingress resource with new Gateway and VirtualServices resources. They work in sync to route all the traffic into the mesh. Inside the mesh there is no requirement for Gateways since the services can access each other by a cluster local service name.\"), mdx(\"h3\", null, \"Let\\u2019s understand the working with a representation\"), mdx(\"p\", null, mdx(\"img\", {\n    src: Rep,\n    align: \"center\",\n    alt: \"Istio Ingress Gateway in Kubernetes No Title\"\n  })), mdx(\"p\", null, mdx(\"ul\", null, mdx(\"li\", null, \"Firstly A request is made by a client on a specific port\"), mdx(\"li\", null, \"Then a load balancer on this port listens and forwards the request to one of the workers in theh cluster on same or a new port\"), mdx(\"li\", null, \"Inside the cluster the request is routed to the Istio Ingress Gateway which is listened on the port of the load balancer\"), mdx(\"li\", null, \"The Service forwards the requestto an Istio Ingress Gateway Pod which is managed by a deployment\"), mdx(\"li\", null, \"The Ingress Gateway Pod is configured by a Gateway and a VirtualService.\"), mdx(\"li\", null, \"The Gateway configures all the ports, protocol, and certificates.\"), mdx(\"li\", null, \"The Virtual Service configures all the routing information to find the correct Servicein it.\"), mdx(\"li\", null, \"The Istio Ingress Gateway Pod routes the request to the application Service.\"), mdx(\"li\", null, \"And lastly, the application Service routes the request to an application Pod which is managed by a deployment.\"))), mdx(\"ul\", null), mdx(\"h2\", null, \"Ingress Gateway Service\"), mdx(\"p\", null, \"The Ingress Gateway Service must listen to all the ports to be able to forward the traffic to the Ingress Gateway pods. Here we will be use the routing to bring the port numbers back to their default numbers.\"), mdx(\"p\", null, \"Please note that a Kubernetes Service is not a \\\"real\\\" service, but, since we are using type: NodePort, the request will be handled by the kube-proxy provided by Kubernetes and forwarded to a node with a running pod. Once on the node, an IP-tables configuration will forward the request to the appropriate pod.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-yaml\"\n  }, \"\\n# From the istio-ingressgateway service\\n  ports:\\n  - name: http2\\n    nodePort: 30000\\n    port: 80\\n    protocol: TCP\\n  - name: https\\n    nodePort: 30443\\n    port: 443\\n    protocol: TCP\\n  - name: mysql\\n    nodePort: 30306\\n    port: 3306\\n    protocol: TCP\\n\")), mdx(\"p\", null, \"If we inspect the service, we will see that it defines more ports than I have describe above. These ports are used for internal Istio communication.\"), mdx(\"h2\", null, \"Ingress Gateway Deployment\"), mdx(\"p\", null, \"It is a wrapper around the Envoy proxy and it is configured in the same way as the sidecars used inside the service mesh (it is actually the same container). When we create or change a Gateway or VirtualService, the changes are detected by the Istio Pilot controller which converts this information to an Envoy configuration and sends it to the relevant proxies, including the Envoy inside the IngressGateway.\"), mdx(\"p\", null, \"Since container ports don't have to be declared in Kubernetes pods or deployments, we don't have to declare the ports in the IngressGateway Deployment. But, if you look inside the deployment you can see that there are a number of ports declared anyway (unnecessarily). What we do have to care about in the IngressGateway Deployment is SSL certificates. To be able to access the certificates inside the Gateway resources, make sure that you have mounted the certificates properly.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-yaml\"\n  }, \"\\n# Example represents volume mounts\\nvolumeMounts:\\n- mountPath: /etc/istio/ingressgateway-certs\\n  name: ingressgateway-certs\\n  readOnly: true\\n- mountPath: /etc/istio/ingressgateway-ca-certs\\n  name: ingressgateway-ca-certs\\n  readOnly: true\\n\\n# Example represents volumes\\nvolumes:\\n- name: ingressgateway-certs\\n  secret:\\n    defaultMode: 420\\n    optional: true\\n    secretName: istio-ingressgateway-certs\\n- name: ingressgateway-ca-certs\\n  secret:\\n    defaultMode: 420\\n    optional: true\\n    secretName: istio-ingressgateway-ca-certs\\n\")), mdx(\"h2\", null, \"The Gateway\"), mdx(\"p\", null, \"The Gateway resources are used to configure the ports for Envoy. Since we have exposed three ports with the service, we need these ports to be handled by Envoy. We can do this by declaring one or more Gateways. In my example, I'm going to use a single Gateway, but it may be split into two or three.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-yaml\"\n  }, \"\\napiVersion: networking.istio.io/v1alpha3\\nkind: Gateway\\nmetadata:\\n  name: default-gateway\\n  namespace: istio-system\\nspec:\\n  selector:\\n    istio: ingressgateway\\n  servers:\\n\\n  - hosts:\\n    - '*'\\n    port:\\n      name: http\\n      number: 80\\n      protocol: HTTP\\n\\n  - hosts:\\n    - '*'\\n    port:\\n      name: https\\n      number: 443\\n      protocol: HTTPS\\n    tls:\\n      mode: SIMPLE\\n      privateKey: /etc/istio/ingressgateway-certs/tls.key\\n      serverCertificate: /etc/istio/ingressgateway-certs/tls.crt\\n\\n  - hosts: # For TCP routing this fields seems to be ignored, but it is matched\\n    - '*'  # with the VirtualService, I use * since it will match anything.\\n    port:\\n      name: mysql\\n      number: 3306\\n      protocol: TCP\\n\")), mdx(\"h2\", null, \"VirtualService\"), mdx(\"p\", null, \"The final interesting resource is the VirtualService, it works in concert with the Gateway to configure Envoy. If you only add a Gateway nothing will show up in the Envoy configuration, and the same is true if you only add a VirtualService.\"), mdx(\"p\", null, \"A general configuration for an HTTP(s) service\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-yaml\"\n  }, \"\\napiVersion: networking.istio.io/v1alpha3\\nkind: VirtualService\\nmetadata:\\n  name: counter\\nspec:\\n  gateways:\\n  - default-gateway.istio-system.svc.cluster.local\\n  hosts:\\n  - counter.lab.example.com\\n  http:\\n  - match:\\n    - uri:\\n      prefix: /\\n    route:\\n    - destination:\\n        host: counter\\n        port:\\n          number: 80\\n\\n\")), mdx(\"h2\", null, \"Application Service and Deployment\"), mdx(\"p\", null, \"Our request have now reached the application service and deployment. These are just normal Kubernetes resources and I will assume that if you have read this far, you already know all about it. \\uD83D\\uDE03\"), mdx(\"h2\", null, \"Extras:\"), mdx(\"h3\", null, \"Debugging Istio Gateway\"), mdx(\"p\", null, \"First use istioctl to check the config status of Istio ingress gateway:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-yaml\"\n  }, \"\\n# istioctl proxy-status istio-ingressgateway-5586f47659-r64lb.istio-system\\nClusters Match\\nListeners Match\\nRoutes Match\\n\\n\")), mdx(\"p\", null, \"If anything is not synced, try restarting the ingress gateway pod - it may be possible that it somehow missed an update. Next, if RDS looked good, you can check access logs. If you have access logs enabled:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-yaml\"\n  }, \"\\n# kubectl get configmap istio -n istio-system -o yaml | grep \\\"accessLogFile: \\\"\\ndisable access log.\\\\naccessLogFile: \\\\\\\"/dev/stdout\\\\\\\"\\\\n\\\\n# If accessLogEncoding\\n\\n\")), mdx(\"p\", null, \"Once access logs are enabled, you can try your request a few more times and then check the logs on the ingress gateway:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-yaml\"\n  }, \"\\n# kubectl logs -n istio-system istio-ingressgateway-5586f47659-r64lb | grep -v deprecated\\n\\n\"))));\n}\n;\nMDXContent.isMDXComponent = true;","frontmatter":{"title":"Istio Ingress Gateway in Kubernetes","subtitle":null,"date":null,"author":null,"category":"Service Mesh","tags":["Gateway"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#f8f8f8","images":{"fallback":{"src":"/static/7d817888386c321cf1d1e87dfbce798b/a44b9/Istio%20Ingress%20Gateway.png","srcSet":"/static/7d817888386c321cf1d1e87dfbce798b/5615b/Istio%20Ingress%20Gateway.png 125w,\n/static/7d817888386c321cf1d1e87dfbce798b/19c8d/Istio%20Ingress%20Gateway.png 250w,\n/static/7d817888386c321cf1d1e87dfbce798b/a44b9/Istio%20Ingress%20Gateway.png 500w","sizes":"(min-width: 500px) 500px, 100vw"},"sources":[{"srcSet":"/static/7d817888386c321cf1d1e87dfbce798b/2de71/Istio%20Ingress%20Gateway.webp 125w,\n/static/7d817888386c321cf1d1e87dfbce798b/1f902/Istio%20Ingress%20Gateway.webp 250w,\n/static/7d817888386c321cf1d1e87dfbce798b/98792/Istio%20Ingress%20Gateway.webp 500w","type":"image/webp","sizes":"(min-width: 500px) 500px, 100vw"}]},"width":500,"height":288}},"extension":"png","publicURL":"/static/7d817888386c321cf1d1e87dfbce798b/Istio Ingress Gateway.png"}},"fields":{"slug":"/resources/service-mesh/istio-ingress-gateway-in-kubernetes"}}},"pageContext":{"slug":"/resources/service-mesh/istio-ingress-gateway-in-kubernetes"}},
    "staticQueryHashes": ["112401468","1247637131","1485533831","1872757318","2104129793","2376360048","2535621439","2799848284","2974092731","3127805956","3180254910","3205812809","3331006692","3532464890","3621468770","3657813679","3666442589","3831724438","4047814605","629128677","673082005","78753834","7929417","803866341"]}